---
title: "feat: Implement WPGraphQL Experiments API"
pr: 3428
author: "jasonbahl"
type: "feat"
breaking: false
---

## What feature does this implement? Explain your changes.

This PR (based on #3098 by @justlevine) implements a comprehensive Experiments API for WPGraphQL that enables us to ship, iterate, and gather feedback on potential core features without long-term compatibility commitments, and without relying on users seeking these experimental features as extension plugins, etc. 

The Extension API allows the community to "experience the future of WPGraphQL today" while maintaining a stable production API.

### Key Features

1. Experiment Lifecycle Management

- Abstract base class for creating experiments
- Registration system for experiments
- Enable/disable experiments via WP Admin, \`wp-config.php\` constants, or filters
- Automatic loading and initialization of active experiments

2. Dependency System

- Required dependencies (experiments that must be active for other experiments to work)
- Optional dependencies (experiments that enhance functionality when available)
- Automatic dependency resolution and validation
- Circular dependency detection
- UI feedback showing dependency status in the Experiments settings tab

3. Admin Interface

- Settings page integration under GraphQL  > Settings > Experiments
- Checkboxes to enable/disable experiments
- Dependency indicators and warnings
- Activation / deactivation messages (each extension can define unique callbacks)

4. GraphQL Extensions Response

- Active experiments are exposed in \`extensions.experiments\` when WPGraphQL is in \`GRAPHQL_DEBUG\` mode
- This helps bring attention to active experiments on the client side
- Production-safe (only appears in debug mode)

5. Comprehensive Documentation

- User guide for enabling and using experiments
- Developer guide for creating experiments
- Contributor guide for proposing experiments
- GitHub issue/PR templates for experiment proposals

6. Test Experiments

- \`TestExperiment\` - Basic experiment demonstrating core functionality
- \`TestDependantExperiment\` - Demonstrates required dependencies
- \`TestOptionalDependencyExperiment\` - Demonstrates optional dependencies

## Does this close any currently open issues?

Relates to #3098 (original Experiments API PR)

## Feature Design

### Developer Experience: Creating Experiments

Creating a new experiment is straightforward and follows WordPress patterns:

**1. Extend \`AbstractExperiment\`:**

\`\`\`php
namespace WPGraphQL\Experimental\Experiment;

class MyExperiment extends AbstractExperiment {
    // Define the experiment slug
    protected static function slug(): string {
        return 'my-experiment';
    }
    
    // Configure the experiment
    protected function config(): array {
        return [
            'title'       => __( 'My Experiment', 'wp-graphql' ),
            'description' => __( 'Description of what this experiment does.', 'wp-graphql' ),
        ];
    }
    
    // Initialize your hooks
    protected function init(): void {
        add_action( 'graphql_register_types', [ $this, 'register_types' ] );
    }
    
    // Optional: Define dependencies
    public function get_dependencies(): array {
        return [
            'required' => [ 'other-experiment' ],  // Must be active
            'optional' => [ 'enhancing-experiment' ],  // Recommended
        ];
    }
    
    // Optional: Custom activation message
    public function get_activation_message(): string {
        return __( 'My Experiment activated! New features available.', 'wp-graphql' );
    }
}
\`\`\`

**2. Register in \`ExperimentRegistry\`:**

\`\`\`php
// In ExperimentRegistry::register_experiments()
protected function register_experiments(): void {
    $registry = [
        'my-experiment' => MyExperiment::class,
        // ... other experiments
    ];
    
    self::$registry = apply_filters( 'graphql_experiments_registered_classes', $registry );
}
\`\`\`

**Or use the filter (for third-party experiments):**

\`\`\`php
add_filter( 'graphql_experiments_registered_classes', function( $registry ) {
    $registry['my-experiment'] = MyExperiment::class;
    return $registry;
} );
\`\`\`

**3. That's it!** The experiment:
- ✅ Automatically appears in WordPress admin
- ✅ Can be toggled on/off by users
- ✅ Respects dependencies (won't load if required deps are missing)
- ✅ Shows in GraphQL extensions when debug is enabled
- ✅ Displays custom activation/deactivation messages
- ✅ Follows WordPress plugin patterns (familiar to WP developers)

### Schema Changes

No changes to the core GraphQL Schema are part of the default Experiments API. 

The Experiments API provides infrastructure that enables future schema changes through individual experiments. Each experiment can add its own types, fields, and mutations when enabled. 

**Example** (when \`TestExperiment\` is enabled):

\`\`\`graphql
type RootQuery {
  # New field added by TestExperiment
 testExperiment: String
}
\`\`\`

**GraphQL Extensions** output (when \`GRAPHQL_DEBUG\` is enabled):

\`\`\`json
{
  "data": { ... },
  "extensions": { 
    ...
    "experiments": [ 'test_experiment" ],
  }
}
\`\`\`

### User Experience

#### Enabling Experiments

1. **Via WP Admin** (easiest):

- Navigate to GraphQL > Settings > Experiments
- Toggle experiments on/off
- Save changes

2. **Via Filter** 

\`\`\`php
   add_filter( 'graphql_experimental_features', function( $experiments ) {
       $experiments['experiment_slug'] = true;
       return $experiments;
   } );
\`\`\`

3. **Via \`wp-config.php** (if defined, overrides the filter):

\`\`\`php
define( 'GRAPHQL_EXPERIMENTAL_FEATURES', [
  'experiment_slug' => true,
] );
\`\`\`

## Implementation Details

### Key Components Added/Modified

- New Directory: \`src/Experimental/ \`- Contains all experiments infrastructure
  - \`Experimental.php\` - Main initialization class
  - \`ExperimentRegistry.php\` - Manages registration and loading of experiments
  - \`Admin.php\` - WordPress admin UI integration
  - \`Extensions.php\` - GraphQL response extensions integration
  - \`Experiment/AbstractExperiment.php \`- Base class for all experiments
  - \`Experiment/TestExperiment.php\` - Example basic experiment
  - \`Experiment/TestDependantExperiment.php\` - Example required dependency
  - \`Experiment/TestOptionalDependencyExperiment.php\` - Example optional dependency
- Documentation (\`docs/\`):
  - \`experiments.md\` - Overview and philosophy
  - \`experiments-using.md\` - User guide (~426 lines)
  - \`experiments-creating.md\` - Developer guide (~689 lines)
  - \`experiments-contributing.md\` - Contributor guide (~547 lines)
  - Updated \`docs_nav.json\` with Experiments section
- GitHub Templates (\`.github/\`):
  - \`ISSUE_TEMPLATE/experiment_proposal.yml\` - Structured experiment proposals
  - \`PULL_REQUEST_TEMPLATE/new-experiment.md\` - New experiment PRs
  - \`PULL_REQUEST_TEMPLATE/experiment-update.md \`- Experiment update PRs
  - \`PULL_REQUEST_TEMPLATE/pull_request_template.md\` - Template chooser
  - Updated \`CONTRIBUTING.md\` with PR template workflow
- Tests (\`tests/wpunit/\`):
  - \`ExperimentRegistryTest.php\` - Registry and dependency tests (14 tests)
  - \`ExperimentalExtensionsTest.php\` - GraphQL extensions tests (7 tests)
  
  ### Performance Considerations

- **Lazy Loading**: Experiments are only loaded when active
- **Caching**: Active experiments are cached per request
- **Minimal Overhead**: Inactive experiments have zero performance impact

## Testing Strategy

### Test Coverage

- 21 comprehensive tests covering:
  - ✅ Experiment registration and activation
  - ✅ Required dependencies (must be active)
  - ✅ Optional dependencies (enhance functionality)
  - ✅ Circular dependency detection
  - ✅ GraphQL field registration when experiments are active
  - ✅ Automatic deactivation of dependents
  - ✅ GraphQL extensions response (debug mode only)
  - ✅ Experiment settings persistence
  - ✅ Admin UI toggle functionality
  - ✅ Constants and filter overrides
  
All Tests Passing: ✅ 868 tests passing (including 21 new experiment tests)

## Documentation Updates

- 4 comprehensive documentation files (~1,700 lines total):
  - ✅ experiments.md - What are experiments, philosophy, FAQ
  - ✅ experiments-using.md - User guide for enabling/testing
  - ✅ experiments-creating.md - Developer guide with patterns and examples
  - ✅ experiments-contributing.md - Contributor guide for proposals
- Updated navigation: Added "Experiments" section to docs_nav.json
- GitHub templates:
  - ✅ Issue template for experiment proposals
  - ✅ PR templates for new experiments and updates
  - ✅ Updated contributing guide
- Inline documentation:
  - ✅ Comprehensive PHPDoc blocks on all classes and methods
  - ✅ Code examples in docblocks
  - ✅ Real-world usage examples in test experiments
  
## Breaking Changes

None. The Experiments API is new functionality that:

- Does not modify existing GraphQL schema (until an experiment is activated)
- Does not change existing WPGraphQL behavior (until an experiment is activated)
- Maintains backwards compatibility (might change when an experiment is activated)

## Future Plans

- Start using the Experiments API to ship features such as: 
  - Custom Scalars (see #3423, #3394, #3390)
  - oneOf input types / fields (see #3416, #3417)
  - MediaItem Interface (see: #764)
  - register_graphql_directive API and query directives (see #3391)
  - possibly pull the WPGraphQL IDE into core WPGraphQL (https://github.com/wp-graphql/wpgraphql-ide)
  - explore Gutenberg (aka Block Editor) support
