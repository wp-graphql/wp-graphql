---
title: "ci: gitignore build directory and improve asset loading"
pr: 3461
author: "jasonbahl"
type: "ci"
breaking: false
---

## What maintenance tasks does this perform?

This PR moves the \`/build\` directory out of version control and improves how WPGraphQL handles missing build assets. This addresses issue #3309 and resolves several CodeQL security alerts.

### Why these changes are needed:
- **Build artifacts don't belong in version control** - They're generated files that cause merge conflicts and bloat the repository
- **CodeQL was flagging issues in bundled vendor code** - By not versioning build files, these alerts go away
- **Better developer experience** - Users who install via Composer or git clone now see helpful messages instead of PHP errors

## Maintenance Changes

### Type of Changes
- [x] CI/CD pipeline improvements
- [x] Build process updates
- [x] Code quality tool updates
- [x] Configuration file updates

### Files Modified

| File | Changes |
|------|---------|
| \`.gitignore\` | Added \`build/\` directory |
| \`.github/workflows/build-graphiql.yml\` | **Deleted** - No longer needed since we don't commit build files |
| \`composer.json\` | Added smart post-install warnings for dev installs |
| \`packages/extensions/PluginCard.js\` | Fixed URL substring sanitization (CodeQL alert) |
| \`src/Admin/GraphiQL/GraphiQL.php\` | Refactored with centralized asset config + graceful error handling |
| \`src/Admin/Extensions/Extensions.php\` | Added build asset checks + helpful error messages |
| \`src/Admin/Updates/Updates.php\` | Added build asset checks |

## Development Workflow Improvements

### What improvements does this provide?
- [x] Better error reporting
- [x] Enhanced development experience
- [x] Improved build process

### Developer Experience
- **WordPress.org / GitHub Release users**: No change - release workflow already runs \`npm run build\` before packaging
- **Composer users**: See a helpful message if \`build/\` is missing, with instructions to run \`npm ci && npm run build\`
- **Git clone users**: Same helpful message guides them to build assets

## Code Quality Improvements

### Security Fixes
- Fixed \`js/incomplete-url-substring-sanitization\` in \`PluginCard.js\` - Changed \`host.includes('github.com')\` to proper regex validation \`/^(.*\.)?github\.com$/i.test(host)\`

### Refactoring
- Centralized GraphiQL asset configuration into \`CORE_ASSETS\` and \`EXTENSION_ASSETS\` constants
- Created reusable \`enqueue_asset()\` helper method
- Added comprehensive docblocks explaining the "why" behind each method

## Testing Strategy

### Test Coverage
- [x] All existing tests pass
- [x] Manual testing: Core functionality verified

### Test Results
- GraphiQL IDE loads correctly when assets are built
- Helpful message displays when assets are missing
- Extensions page handles missing assets gracefully
- No PHP warnings/errors in either state

## Impact Assessment

### What is the impact of these changes?
- [x] No impact on WPGraphQL functionality (for users with built assets)
- [x] Improved development workflow
- [x] Better code quality
- [x] Reduced repository size
- [x] Better error reporting

### Breaking Changes
- [x] No breaking changes for end users
- Developers who clone the repo need to run \`npm ci && npm run build\` (documented in error messages)

## Additional Context

- Closes #3309
- Resolves CodeQL alerts: #149, #150, #151, #152, #153

### Installation Method Impact

| Method | Has Build Assets | Action Required |
|--------|------------------|-----------------|
| WordPress.org | ✅ Yes | None |
| GitHub Release ZIP | ✅ Yes | None |
| Composer (wpackagist) | ✅ Yes | None |
| Composer (GitHub/Packagist) | ❌ No | Run \`npm ci && npm run build\` |
| Git clone | ❌ No | Run \`npm ci && npm run build\` |
