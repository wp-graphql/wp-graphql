---
title: "fix: update failing e2e tests for graphiql"
pr: 3414
author: "jasonbahl"
type: "fix"
breaking: false
---

## What does this implement/fix? Explain your changes.

This PR fixes broken e2e tests for the WPGraphQL settings page that were caused by recent changes to the wp-env configuration format.

### Root Cause
In PR (https://github.com/wp-graphql/wp-graphql/pull/3408/files), the \`.wp-env.json\` configuration was restructured to use the new wp-env format that separates development and test environments:
- Development environment: \`localhost:8888\` (custom plugin not loaded)
- Tests environment: \`localhost:8889\` (custom plugin loaded)

However, the e2e tests were still connecting to the development environment where the custom test plugin wasn't available.

### Changes Made

1. **Fixed test environment URLs** (\`tests/e2e/utils.js\`):
   - Updated \`wpHomeUrl\` and \`wpAdminUrl\` from \`localhost:8888\` to \`localhost:8889\`
   - Updated \`loginToWordPressAdmin()\` to use the correct test environment

2. **Fixed authentication logic bug** (\`tests/e2e/utils.js\`):
   - Fixed \`loginToWordPressAdmin()\` to check for existing authentication *after* navigating to the admin page
   - Previously checked for \`#wpadminbar\` before navigation, causing timeouts

3. **Enhanced custom test plugin** (\`tests/e2e/plugins/settings-page-spec/settings-page-spec.php\`):
   - Added complete WordPress plugin headers (Version, Author, License, etc.)
   - Added security check to prevent direct access

4. **Fixed wp-env plugin configuration** (\`.wp-env.json\`):
   - Changed plugin path from pointing to PHP file to plugin directory
   - From: \`"./tests/e2e/plugins/settings-page-spec/settings-page-spec.php"\`
   - To: \`"./tests/e2e/plugins/settings-page-spec"\`

5. **Cleaned up localStorage handling** (\`tests/e2e/specs/settings-page.spec.js\`):
   - Removed problematic \`localStorage.clear()\` from \`beforeEach\` hook
   - Added safe localStorage clearing in the specific test that needs it

### Test Results
All 4 settings page e2e tests now pass:
- ✅ Verify custom plugin is active and tabs are present
- ✅ Switch between tabs and verify visibility
- ✅ Verify checkbox functionality in Section A and B
- ✅ Verify localStorage retains last active tab

## Does this close any currently open issues?

no
